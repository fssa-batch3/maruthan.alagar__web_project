<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M A M Billing</title>
    <link rel="stylesheet" href="../../assets/css/billing/newbill.css">

</head>

<body>
    <header>
        <div>
            <div class="nav">
                <div class="logo">
                    <img src="../../assets/Imges/M_A_M.png    " alt="Logo pic" />
                </div>
                <div class="list">
                    <ul class="link">
                        <li class="navlist"><a href="../billing/billing.html" class="navlist"> &#8592; Back to Billing
                                History</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </header>
    <main>
        <form>
            <div class="symbol">
                <div class="namebar">
                    <div id="customer">
                        <div>
                            <label>Customer Name:</label>
                            <input class="lists" type="text" id="customer_name" placeholder="Enter Customer Name"
                                required />
                        </div>
                        <div>
                            <label>ID Number:</label>
                            <input class="lists" type="text" id="customer_id" placeholder="Enter ID Number" required />
                        </div>
                        <div>
                            <label>Phone Number:</label>
                            <input class="lists" type="tel" id="customer_phone" placeholder="Enter Mobile Number"
                                required />
                        </div>
                        <div>
                            <label>Date</label>
                            <input type="date" id="date-input">
                        </div>
                        <a href="../customer/billingside.html"><button type="button" id="add"><img src="../../assets/Imges/plus.jfif" id="customerpic" alt="plus pic"></button></a>
                    </div>
        </form>
        <form id="pro">
            <div id="top">




                <div>
                    <label>Product Name:</label>
                    <input class="lists" id="product_name" type="text" placeholder="Product Name" required />
                </div>

                <div>
                    <label>Product ID</label>
                    <input class="lists" id="product_id" type="text" placeholder="Enter Product ID" required />
                </div>



                <div>
                    <label>Quantity:</label>
                    <input class="lists" id="quantity" type="number" placeholder="Choose Number" required />
                </div>


                <div>
                    <label>Price:</label>
                    <input class="lists" id="price" type="text" placeholder="Enter price" required />
                </div>
                <div>
                    <label>Tax:</label>
                    <input class="lists" id="tax" type="text" placeholder="Enter Tax" />
                </div>
                <div>
                    <label>Discount:</label>
                    <input class="lists" id="discount" type="text" placeholder="Enter Discount" />
                </div>
                <button type="button" id="add" onclick="newDetail()"><img src="../../assets/Imges/plus.jfif"  id="customerpic" alt="plus pic"></button>

            </div>

            </div>
        </form>




    </main>
    <section>
        <form id="payment">
            <div>

                <label> Payment Method</label>
                <div id="radiobuttons">
                    <input id="radio" type="radio" value="Cash">
                    <lable>Cash</lable>
                    <input id="radio" type="radio" value="Card">
                    <lable>Card</lable>
                    <input id="radio" type="radio" value="UPI">
                    <lable>UPI</lable>
                </div>

                <div>

                    <label>Txn.ID :</label>
                    <input type="text" readonly>
                </div>
                <div>

                    <label>Amount :</label>
                    <input type="number">
                </div>
                <div>
                    <label>Balance :</label>
                    <input type="number">
                </div>
            </div>




            <div>

                <div>
                    <label>Total MRP :</label>
                    <input type="number">
                </div>
                <div>
                    <label>Total Tax :</label>
                    <input type="number">
                </div>
                <div>
                    <label>Total Discount :</label>
                    <input type="number">
                </div>
                <div>
                    <label>Total Price :</label>
                    <input type="number">
                </div>
            </div>
            <div>
                <h2>Sub Total :</h2>
                <input type="number" readonly>
                <h1>Total :</h1>
                <input type="number" readonly>


            </div>

            <div id="buttonDiv">
                <button class="btn" id="btn" onclick="saveData()" type="submit">Save Bill</button>
                <button class="btn" id="btn" onclick="saveData()"type="submit">Save & Print</button>
            </div>

        </form>
    </section>







    <script>




        // main table
        main_table = document.createElement("table");
        main_table.setAttribute("class", "table");




        // table row
        table_row = document.createElement("tr");
        table_row.setAttribute("class", "tb1");
        // label_name.innerText = register_shop[i]["name"];
        main_table.append(table_row);

        //table coloumn_1
        table_coloumn = document.createElement("th");
        table_coloumn.innerText = " S.No";
        table_row.append(table_coloumn);


        //table coloumn_2
        table_coloumn = document.createElement("th");
        table_coloumn.innerText = "Item Name";
        table_row.append(table_coloumn);

        //table coloumn_3
        table_coloumn = document.createElement("th");
        table_coloumn.setAttribute("class", "forres");
        table_coloumn.innerText = "Quantity";
        table_row.append(table_coloumn);



        //table coloumn_4
        table_coloumn = document.createElement("th");
        table_coloumn.innerText = "MRP";
        table_row.append(table_coloumn);

        //table coloumn_5
        table_coloumn = document.createElement("th");
        table_coloumn.innerText = "Price";
        table_row.append(table_coloumn);

        //table coloumn_6
        table_coloumn = document.createElement("th");
        table_coloumn.innerText = "Tax";
        table_row.append(table_coloumn);


        //table coloumn_7
        table_coloumn = document.createElement("th");
        table_coloumn.innerText = "Discount";
        table_row.append(table_coloumn);

        //table coloumn_8
        table_coloumn = document.createElement("th");
        table_coloumn.innerText = "Amount";
        table_row.append(table_coloumn);




        const customer_bill_Details = JSON.parse(sessionStorage.getItem("customer_bill_Details")) || [];




        //  table coloumn_8
        //    table_9 = document.createElement("th"); 
        //    table_9.setAttribute("id","for-plus")          
        //    table_row.append(table_9);

        // table_input_9 = document.createElement("img")
        //  table_input_9.setAttribute("src","../../assets/Imges/plus.jfif")
        //  table_input_9.setAttribute("onclick","tableRows()")
        //  table_input_9.setAttribute("id","coloum")
        //  table_input_9.setAttribute("alt","Plus Img")
        //  table_9.append(table_input_9)

        //    }
        document.querySelector("main").append(main_table)





        const dateInput = document.getElementById('date-input');

        const systemDate = new Date();

        const year = systemDate.getFullYear();
        const month = (systemDate.getMonth() + 1).toString().padStart(2, '0');
        const day = systemDate.getDate().toString().padStart(2, '0');
        const dateString = `${year}-${month}-${day}`;

        dateInput.value = dateString;



        function newDetail() {
            
       
        //     let serial = customer_bill_Details[0].product_details.length+1;
        // console.log(serial)


            let product_name = document.getElementById("product_name");
            let quantity = document.getElementById("quantity");
            let product_id = document.getElementById("product_id");
            let price = document.getElementById("price");
            let tax = document.getElementById("tax");
            let discount = document.getElementById("discount");
            let customer_id = document.getElementById("customer_id");
            let customer_name = document.getElementById("customer_name");
            let customer_phone = document.getElementById("customer_phone");






            let newItem = {
                product_name: product_name.value,
                quantity: quantity.value,
                product_id: product_id.value,
                price: price.value,
                tax: tax.value,
                discount: discount.value,
                // serial : serial.value
              


            };
            let customer = {
                customer_id: customer_id.value,
                customer_name: customer_name.value,
                customer_phone: customer_phone.value,
                dateInput: dateInput.value,
                product_details: [newItem]
            }




            let customer_bill;

            function findDetail(e) {
                return e.customer_id === customer_id.value;
            }


            if(customer_name.value.length === 0){
                alert("Please Enter Customer name")
            }
            else if(customer_id.value.length === 0){
                alert("Please Enter Customer Id")
            }
            else if(customer_phone.value.length === 0){
                alert("Please Enter Customer Phone")
            }
            else if(product_name.value.length === 0){
                alert("Please Enter Product name")
            }
            else if(quantity.value.length === 0){
                alert("Please Enter Quantity")
            }
            else if(product_id.value.length === 0){
                alert("Please Enter Product ID")
            }
            else if(price.value.length === 0){
                alert("Please Enter Price")
            }
            else if(tax.value.length === 0){
                alert("Please Enter Tax")
            }




            else if (customer_bill = customer_bill_Details.find(findDetail)) {
                customer_bill.product_details.push(newItem);
                alert("Product is Sucessfully Added");
                sessionStorage.setItem("customer_bill_Details", JSON.stringify(customer_bill_Details));
            }
            else {
                customer_bill_Details.push(customer);
                alert("Product is Sucessfully Created");
                sessionStorage.setItem("customer_bill_Details", JSON.stringify(customer_bill_Details));
            }
            

           
            




            
            for (let i = 0; i < customer_bill_Details.length; i++) {

        for (let i = 0; i < customer_bill_Details[i].product_details.length; i++) {
            // table row
            table_row_1 = document.createElement("tr");
            table_row_1.setAttribute("class", "tb1");

            main_table.append(table_row_1);

            table_coloumn_1 = document.createElement("td");
            table_coloumn_1.innerText =customer_bill_Details[0].product_details.length +1;
            table_row_1.append(table_coloumn_1);
           

            table_coloumn_2 = document.createElement("td");
            // table_coloumn_1.innerText = customer_bill_Details[0].product_details[i].product_name
            table_row_1.append(table_coloumn_2);

            table_coloumn_3 = document.createElement("td");
            table_row_1.append(table_coloumn_3);

            table_coloumn_4 = document.createElement("td");
            table_row_1.append(table_coloumn_4);

            table_coloumn_5 = document.createElement("td");
            table_row_1.append(table_coloumn_5);

            table_coloumn_6 = document.createElement("td");
            table_row_1.append(table_coloumn_6);

            table_coloumn_7 = document.createElement("td");
            table_row_1.append(table_coloumn_7);

            table_coloumn_8 = document.createElement("td");
            table_row_1.append(table_coloumn_8);



        }
        }
        }

        function saveData(){
            const customer_bill_Details = JSON.parse(sessionStorage.getItem("customer_bill_Details"))
            const bill_Details = JSON.parse(localStorage.getItem("bill_Details"))  || []
           bill_Details.push(customer_bill_Details)
            localStorage.setItem("bill_Details", JSON.stringify(bill_Details));
            sessionStorage.clear();

        }










    </script>